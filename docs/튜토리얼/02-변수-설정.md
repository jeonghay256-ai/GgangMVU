# 변수 설정 및 초기화
💡 튜토리얼에 사용된 예제 카드는 [**캐릭터 카드 예시**](https://github.com/StageDog/tavern_helper_template/tree/main/src/%E8%A7%92%E8%89%B2%E5%8D%A1%E7%A4%BA%E4%BE%8B)에서 찾을 수 있어요!

## 🤔 어떤 변수가 필요한지 고민하기
MVU 카드를 작성할 때는 먼저 이 카드에 어떤 변수가 필요한지 생각해야 합니다.

* 연애 시뮬레이션: 캐릭터와 연애하는 카드를 만들 계획인가요? 캐릭터가 플레이어에게 갖는 '호감도'를 기록해 두면, 현재 호감도 단계에 따라 캐릭터에게 서로 다른 행동 패턴을 설정할 수 있습니다!

* 판타지 모험: 판타지 모험 카드를 만드셨나요? 그렇다면 가방 안에 어떤 아이템이 있는지, 어떤 스킬을 배웠는지 등 모험 중인 캐릭터의 다양한 상태를 기록하고 싶으실 겁니다.

* 시스템/치트물: 뭐라고요! 플레이어가 캐릭터를 연기하는 게 아니라, 캐릭터에 빙의된 **'치트 시스템'**을 연기한다고요? 그렇다면 현재 캐릭터에게 어떤 퀘스트를 줬는지, 시스템 상점에는 어떤 상품이 있는지 꼼꼼히 기록해야겠죠... 심지어 플레이어가 직접 퀘스트를 줄 수 있는 상호작용 가능한 인터페이스를 만들 수도 있습니다!

* ...... 아무튼, 자신의 카드에 어떤 변수가 필요한지 꼭, 반드시 확실하게 생각해 두세요. 이것이 이후의 모든 내용에 영향을 미치기 때문입니다!

## 🏗️ 변수 구조 설계하기
필요한 변수가 정해졌다면, 이제 변수 구조 설계를 시작해 봅시다!

여러분이 쉽게 작성할 수 있도록, 본문에서는 가능한 한 이미 만들어진 도구를 사용하여 카드를 작성하겠습니다! 예를 들어,[**문지기(Gatekeeper) 작성 도우미**](https://stagedog.github.io/%E9%9D%92%E7%A9%BA%E8%8E%89/%E4%BD%9C%E5%93%81%E9%9B%86/)나 [**메메(Miemie)의 Gemini CLI 자동 카드 작성 워크플로우**](https://discord.com/channels/1291925535324110879/1425536223291904151/1425536223291904151)에 있는 변수 구조 설계(스크립트) 기능을 직접 사용하여 변수 구조를 설계할 것입니다.

자, **'문지기 작성 도우미'**를 열고, 실리태번 입력창 위에 있는 기능 선택 버튼을 통해 [변수 구조 설계(스크립트)] 기능으로 전환한 다음, 우리의 변수 요구사항을 입력해 봅시다.

```text
변수를 만들어줘!
- '월드인포(world info)' 경로 아래에 현재 시간, 현재 날짜, 최근 사건을 기록할 것.
- 주인공의 여동생 '하쿠아(白娅)'가 주인공에게 갖는 의존도, 복장, 칭호를 기록할 것.
  - 의존도는 반드시 0~100 사이여야 함.
  - 복장에는 상의, 하의, 속옷, 양말, 신발, 장신구가 포함됨.
  - 칭호는 칭호의 효과와 하쿠아의 칭호에 대한 자기 평가를 기록해야 하며, 자기 평가를 입력하지 않으면 기본값을 "평가 대기 중"으로 설정할 것.
  - 칭호에는 수량 제한이 있음. 의존도가 높을수록 더 많은 칭호를 가질 수 있음(의존도가 0일 때는 칭호 없음, 1~10일 때는 1개, 이런 식으로 증가). 칭호가 소유 가능 수량을 초과하면 가장 오래된 칭호를 제거해야 함.
- 주인공 인벤토리(물품란)에 있는 현재 아이템을 기록: 설명과 수량을 포함하며, 수량을 입력하지 않으면 기본값은 1, 수량이 양수가 아니면 아이템을 즉시 삭제해야 함.
```

요구사항을 꽤 많이 입력했네요. 만약 여러분이 기존 MVU나 MVU beta에 익숙하다면, 저 요구사항들 중 상당수가 예전에는 extensible, `$template` 또는 별도의 스크립트를 작성해야만 구현 가능했다는 걸 아실 겁니다. 하지만 이제 MVU Zod에서는 아주 쉽게 처리할 수 있습니다!

AI도 이런 건 정말 잘 작성하거든요~ 그래서 여기서는 '문지기 작성 도우미'를 사용해 바로 생성하는 방법을 택했습니다. 만약 변수 구조를 직접 손으로 코딩(작성)하는 법을 배우고 싶다면, 본문을 다 읽은 후에 부록 부분을 참고해 주세요.

!!! ⚠️ 주의사항: 변수 구조 안에서 매크로(예: {{user}})를 변수 이름으로 사용하지 마세요. 대신 '주인공'처럼 매크로가 필요 없는 이름을 써야 합니다.

정 쓰고 싶다면 AI에게 변수명으로 {{user}} 대신 [substitudeMacros('{{user}}')]를 쓰라고 알려줘야 하고, 오류가 안 나길 기도해야 합니다... 그러니 그냥 안 쓰는 게 편합니다.

AI가 금방 변수 구조를 생성해 줄 겁니다! 제가 얻은 결과물은 다음과 같습니다:

??? info "변수 구조"

    ```javascript
    import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';

    export const Schema = z.object({
      세계: z.object({
        현재시간: z.string(),
        현재장소: z.string(),
        최근사건: z.record(z.string().describe('사건명'), z.string().describe('사건 설명')),
      }),

      하쿠아: z
        .object({
          의존도: z.coerce.number().transform(v => _.clamp(v, 0, 100)),
          복장: z.record(z.enum(['상의', '하의', '속옷', '양말', '신발', '장신구']), z.string().describe('복장 설명')),
          칭호: z.record(
            z.string().describe('칭호명'),
            z.object({
              효과: z.string(),
              자기평가: z.string().prefault('평가 대기 중'),
            }),
          ),
        })
        .transform(data => {
          // 의존도에 따라 칭호 개수를 제한하는 로직
          data.칭호 = _(data.칭호)
            .entries()
            .takeRight(Math.ceil(data.의존도 / 10))
            .fromPairs()
            .value();
          return data;
        }),

      주인공: z.object({
        인벤토리: z
          .record(
            z.string().describe('아이템명'),
            z.object({
              설명: z.string(),
              수량: z.coerce.number().prefault(1),
            }),
          )
          // 수량이 0 이하인 아이템은 자동으로 삭제하는 로직
          .transform(data => _.pickBy(data, ({ 수량 }) => 수량 > 0)),
      }),
    });

    $(() => {
      registerMvuSchema(Schema);
    });
    ```


이 변수 구조는 실리태번 어시스턴트 스크립트로, 우리의 변수가 어떤 모습이어야 하는지를 규정합니다. '문지기 카드 작성 도우미'가 생성 직후 자신이 어떤 기능을 수행했는지 간략히 설명해 주겠지만, 굳이 지금 당장 그 내용을 해석하려고 애쓸 필요는 없습니다. 나중에 [부록: 손으로 쓰는 변수 구조] 파트에서 제가 자세히 설명해 드릴 테니까요 qwq.

실리태번 어시스턴트 스크립트인 만큼, JS Runner의 스크립트 라이브러리를 열어서 추가해 봅시다! 이전에 MVU 메인 스크립트를 추가했을 때와 똑같습니다. 실리태번 우측 상단의 확장 버튼 ‣ 어시스턴트(Script/QR) ‣ 스크립트 라이브러리를 순서대로 열고, + 스크립트를 클릭하여 변수 구조라는 이름의 캐릭터 스크립트를 새로 만듭니다. 내용은 방금 확인한 그 스크립트 내용을 그대로 채워 넣으면 됩니다.

## 변수 초기화 (Initialize Variables)

변수 구조를 통해 변수의 형태를 규정했으니, 이제 캐릭터 카드가 시작될 때의 변수 초기 상태를 설정할 수 있습니다!

'문지기 카드 작성 도우미'를 변수 초기 설정(initvar) 모드로 전환하고, 변수 초기화에 필요한 요구 사항을 입력해 보세요. 예를 들어 이 줄거리를 바탕으로 변수를 초기화해 줘라거나, 주인공에 대한 백야의 호감도는 20 정도여야 해. 이에 맞춰 변수를 초기화하고 오프닝을 생성해 줘 같은 식으로 말이죠. 이건 전적으로 여러분의 선택에 달려 있습니다~

아무튼, '문지기 카드 작성 도우미'가 제게 아래 내용을 출력해 주었는데, 여기에는 변수가 가져야 할 초기값들이 나열되어 있습니다. 자세히 살펴보면, 텍스트와 들여쓰기가 앞서 본 변수 구조 스크립트와 일대일로 일치한다는 것을 발견하실 수 있을 겁니다.


??? info "변수 초기화 예시"

    ```yaml
    세계:
      현재 시각: 2024-04-08 10:45
      현재 위치: 사립 카자마츠리 학원 고등부 2학년 A반 교실
      최근 이슈:
        전학생 배치: 백야(Baiya)가 막 전학을 왔으니 교재를 수령하고 교내 환경을 익혀야 함
        자리 배치: 반장이 최종 좌석표를 확인 중이라 약간의 변동이 있을 수 있음
        점심시간 임박: 1교시만 지나면 점심시간, 백야에게 접근할 기회임
    백야:
      의존도: 35
      복장:
        상의: 단정한 짙은 남색 교복 재킷, 단추를 하나도 빠짐없이 꼼꼼하게 잠갔음
        하의: 반듯한 짙은 남색 플리츠 스커트, 무릎에 딱 떨어지는 길이
        속옷: 순백색 속옷 세트
        양말: 검은색 오버니삭스, 주름 하나 없이 팽팽함
        신발: 검은색 가죽 학생화, 반짝이게 닦여 있음
        장신구: 없음
      칭호:
        송장:
          효과: 평소 행동에서 눈에 띄는 권태감과 기계적인 느낌이 묻어남
          자평: 살아있는 것 자체가 형벌이다
        도피자:
          효과: <user>의 모든 접촉을 본능적으로 회피함
          자평: 난 그 사람 인생에 끼어들 자격이 없어
    주인공:
      소지품:
        낡은 반창고:
          설명: 지갑 틈새에 2년이나 넣어둔 캐릭터 반창고, 접착력은 아마 다 날아갔을 것임
          수량: 1
        박하사탕:
          설명: 잠 깨는 용도의 강력 박하사탕, 예전에 그녀는 이 냄새를 아주 싫어했음
          수량: 1
    ```


변수 초기값을 얻었다면, 이제 MVU가 규정한 방식대로 이 값들을 입력해 주어야 합니다.

캐릭터 카드의 **월드 인포(World Info)**에 새로운 항목을 하나 만들어 봅시다. 항목 이름에는 반드시 `[initvar]`가 포함되어야 하며, **반드시 '비활성화(Disabled)'** 상태여야 합니다. 항목 이름은 `[initvar]변수초기화_켜지마` 정도로 해두는 게 좋겠네요! 그런 다음, 방금 얻은 변수 초기값을 이 항목의 내용에 붙여넣으세요.