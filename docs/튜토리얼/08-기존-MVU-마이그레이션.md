## 부록. 구형 MVU 카드 마이그레이션 (이전)

### 왜 구형 MVU 카드를 이전해야 할까요?

만약 이 튜토리얼의 본문을 이미 읽으셨다면, **MVU Zod**가 기존의 MVU 본체(Stock)나 MVU Beta보다 훨씬 뛰어나다는 개념을 잡으셨을 겁니다. 
혹시 안 읽으셨더라도... MVU Zod가 기존 버전보다 우수한 점은 다음과 같습니다 (이게 전부는 아닙니다!):

* **강력한 변수 제어:** "변수 값을 특정 범위로 제한", "변수 값 오류 시 자동 수정", "다른 변수에 의존하는 값(예: 호감도 수치에 따라 호감도 단계 자동 설정)", "특정 상황에서만 존재하는 변수", "아이템 슬롯 최대 10개 제한" 등... 
    원래는 AI를 들들 볶아서(拷打) 복잡한 스크립트를 짜야만 가능했던 기능들을, **Zod 변수 정의**만으로 아주 쉽게 구현할 수 있습니다.
* **향상된 토큰 효율:**
    새로 설계된 변수 업데이트 규칙 프롬프트는 기존 작성법보다 **토큰을 훨씬 적게 소모**하며, AI가 더 정확하게 이해합니다.
* **안정적인 출력 포맷 (JSON Patch):**
    변수 출력 형식이 사용자 정의 `_.set` 등의 명령어에서 표준 **JSON patch**로 변경되었습니다. 테스트 결과, 형식을 올바르게 유지하는 능력이 훨씬 뛰어났습니다.
* **AI 친화적인 구조:**
    새로운 변수 구조 작성법, 초기 변수(initvar) 작성법, 변수 프롬프트 작성법이 모두 더 명확해졌으며, **AI가 생성하기에도 더 적합**합니다. 간단히 말해, 각종 카드 제작 도우미나 워크플로우를 만들기에 최적화되어 있습니다.

### 🧪 실전 테스트 결과
실제로 `claude-sonnet-4.5` 모델을 사용하여 **아이템창, 장비창, 시스템 패널, 스킬, 퀘스트, 상점** 등 복잡한 변수를 가진 MVU Zod 카드를 플레이해 본 결과, **200턴(Log) 동안 단 한 번의 변수 업데이트 오류도 발생하지 않았습니다.**

🛠️ 마이그레이션(이전) 단계 및 주의사항
만약 이미 **MVU 본체(Stock)**나 MVU Beta를 사용하여 작성된 캐릭터 카드가 있는데, 이를 MVU Zod 버전으로 바꾸고 싶다면 다음 내용에 주의해야 합니다.

1. [initvar] (초기 변수) 설정
[값, 설명] 스타일 금지: MVU Zod에서는 [initvar] 항목에 [값, 설명] 형태의 구형 배열 스타일을 사용하는 것을 권장하지 않습니다! 이 방식은 변수 사용을 매우 번거롭게 만듭니다. 튜토리얼 본문을 읽고 변수 부분을 **새로 제작(리메이크)**하는 것을 추천합니다.

구형 유지 시 주의점: 만약 리메이크하기 싫어서 구형 [값, 설명] 스타일을 그대로 쓴다면, 변수를 사용하는 모든 곳(EJS 스크립트, 프론트엔드 코드 등)에서 값을 가져올 때 [0]을 붙이던 방식을 전부 수정해야 합니다. (이제 변수: 값 형식이 기본이므로 [0]이 필요 없습니다.)

기능 분리: 구버전의 [initvar]는 MVU Zod에서 두 가지로 분리되었습니다.

변수 구조 스크립트: 객체의 확장 가능 여부 등을 정의.

[initvar] 항목: 변수의 초기값만 설정.

2. 오프닝(인사말)별로 다른 초기값 설정
<initvar> 블록 사용: 이제 오프닝(Greeting) 필드 안에 직접 <initvar> 블록을 넣어서, 선택된 오프닝에 따라 다른 초기 변수 값을 설정할 수 있습니다.

기존 _.set 명령어: 만약 오프닝에서 _.set 명령어로 초기값을 설정하고 있었다면, 굳이 바꿀 필요는 없습니다. MVU Zod도 이 방식을 지원합니다.

단, 원래 [값, 설명] 스타일(코드 뒤에 [0]이 붙는 식)이었다면 새로 생성하는 것이 좋습니다.

변환 방법: _.set 명령어를 최신 <initvar> 블록으로 바꾸고 싶다면, 변수 관리자에서 각 오프닝 상황의 stat_data 값을 복사한 뒤, '문의 주인(Door Lord)의 변수 초기 설정 프롬프트'에게 보내서 변환해 달라고 하세요.

3. 변수 목록 프롬프트 ({{get...}})
{{get_message_variable::xxx}}라고 적힌 프롬프트를 **{{format_message_variable::xxx}}**로 교체하는 것을 권장합니다.

만약 별도로 커스텀한 목록이 아니라 MVU 예제를 그대로 복사해서 쓰고 있었다면, 그냥 통째로 교체하면 됩니다.

4. 변수 업데이트 규칙
기존 규칙(예: "사용자의 행동에 따라 호감도를 증감시켜라" 등)도 여전히 작동은 합니다.

하지만 새로운 변수 업데이트 규칙 포맷으로 바꾸는 것을 강력 추천합니다. 토큰을 덜 먹고, AI가 더 정확하게 이해합니다.

5. 변수 출력 형식 (<UpdateVariable> 등)
MVU Zod가 여전히 _.set 명령어를 인식하긴 하지만, 오류가 적고 안정적인 **새로운 변수 출력 형식(JSON Patch)**으로 교체하는 것이 가장 좋습니다.

💡 결론: 어떻게 변환할까요?
가장 좋은 방법은 튜토리얼 본문을 읽고 해당 부분만 새로 만드는 것입니다.

하지만 자동화 도구를 사용할 수도 있습니다: **[<u>문의 주인(Door Lord) 카드 작성 도우미</u>](https://stagedog.github.io/%E9%9D%92%E7%A9%BA%E8%8E%89/%E4%BD%9C%E5%93%81%E9%9B%86/)**를 사용하거나 **[<u>Miemie의 Gemini CLI 전자동 카드 작성 워크플로우</u>](https://discord.com/channels/1291925535324110879/1425536223291904151/1425536223291904151)**를 사용하시는 것을 추천드려요. (물론, 나중에 직접 수정하려면 튜토리얼을 한번 읽어보시는 것을 추천합니다! qaq)



!!! 💡 팁: 구형 스타일(`[값, 설명]`) 처리 방법

만약 기존 카드의 `initvar`가 `변수명: [값, 설명]` 스타일로 작성되어 있다면, 변환 작업을 요청할 때 **반드시 아래 프롬프트를 함께 전송**해야 합니다.

```text
제가 보내드리는 JSON/YAML 변수 정보는 `변수명: [값, 설명]` 형식입니다. 
여기서 `값`은 실제 변수 값이고, `설명`은 변수의 용도나 업데이트 규칙일 수 있습니다. 
생성할 때 반드시 `변수명: 값` 형식으로 변환해 주시고, 만약 코드 내에 있다면 더 이상 필요 없는 `[0]` 인덱스 접근 구문을 제거해 주세요.
```


### 🚀 단계별 마이그레이션 가이드

'문의 주인(Door Lord) 카드 작성 도우미'를 활용한 표준 마이그레이션 절차입니다.

1. **변수 구조 스크립트 생성**
* `구형 initvar` + `변수 구조 설계 프롬프트`  **변수 구조 설계 스크립트** 생성
* 이것을 **새로운 Tavern Assistant 스크립트**로 추가합니다.


2. **새로운 initvar 생성**
* `변수 구조 설계 스크립트` + `변수 초기 설정 프롬프트`  **새로운 initvar** 생성
* 이것을 **`[initvar]변수 초기화(열지 마시오)`** 항목으로 새로 만들고 **비활성화(닫음)** 상태로 둡니다.


3. **변수 업데이트 규칙 갱신**
* `구형 변수 업데이트 규칙` + `변수 업데이트 규칙 프롬프트`  **새로운 변수 업데이트 규칙 프롬프트** 생성
* 이것을 **`[mvu_update]변수 업데이트 규칙`** 항목으로 새로 만들고, 보통 **Depth 0**에 배치합니다.


4. **변수 출력 형식 적용**
* **`[mvu_update]변수 출력 형식`**을 복사합니다.
* 이것을 **`[mvu_update]변수 출력 형식`** 항목으로 새로 만들고, 보통 **Depth 0**에 배치합니다.


5. **변수 목록 적용**
* **`변수 목록`**을 복사합니다.
* 이것을 **`변수 목록`** 항목으로 새로 만들고, **Depth 0**에 배치합니다.