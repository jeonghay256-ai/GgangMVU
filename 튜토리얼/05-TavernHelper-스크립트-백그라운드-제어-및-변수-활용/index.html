<!DOCTYPE html><html lang="ko" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="MVU Zod 플러그인 사용법을 위한 한국어 가이드">
      
      
      
        <link rel="canonical" href="https://example.github.io/mvu-zod-guide/%ED%8A%9C%ED%86%A0%EB%A6%AC%EC%96%BC/05-TavernHelper-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EB%B0%B1%EA%B7%B8%EB%9D%BC%EC%9A%B4%EB%93%9C-%EC%A0%9C%EC%96%B4-%EB%B0%8F-%EB%B3%80%EC%88%98-%ED%99%9C%EC%9A%A9/">
      
      
        <link rel="prev" href="../04-%ED%94%84%EB%A1%AC%ED%94%84%ED%8A%B8-%ED%85%9C%ED%94%8C%EB%A6%BF-%ED%94%84%EB%A1%AC%ED%94%84%ED%8A%B8%EB%A5%BC-%EB%8F%99%EC%A0%81%EC%9C%BC%EB%A1%9C-%EC%A0%84%EC%86%A1/">
      
      
        <link rel="next" href="../06-%EC%83%81%ED%83%9C%EB%B0%94/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>TavernHelper 스크립트 - 백그라운드 제어 및 변수 활용 - MVU Zod 한국어 가이드</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Noto Sans KR";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tavernhelper" class="md-skip">
          콘텐츠로 이동
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="상단/헤더">
    <a href="../.." title="MVU Zod 한국어 가이드" class="md-header__button md-logo" aria-label="MVU Zod 한국어 가이드" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MVU Zod 한국어 가이드
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TavernHelper 스크립트 - 백그라운드 제어 및 변수 활용
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom" aria-label="다크 모드로 전환" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="다크 모드로 전환" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom" aria-label="라이트 모드로 전환" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="라이트 모드로 전환" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="검색" placeholder="검색" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="검색">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="공유" aria-label="공유" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="지우기" aria-label="지우기" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            검색 초기화
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="네비게이션" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MVU Zod 한국어 가이드" class="md-nav__button md-logo" aria-label="MVU Zod 한국어 가이드" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    MVU Zod 한국어 가이드
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    홈
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    튜토리얼
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    튜토리얼
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EC%84%A4%EC%B9%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    플러그인 설치
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-%EB%B3%80%EC%88%98-%EC%84%A4%EC%A0%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    변수 설정
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-%EB%B3%80%EC%88%98-%ED%94%84%EB%A1%AC%ED%94%84%ED%8A%B8-AI%EA%B0%80-%EB%B3%80%EC%88%98%EB%A5%BC-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B2%8C-%EB%A7%8C%EB%93%A4%EA%B8%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    변수 프롬프트 - AI가 변수를 이해하게 만들기
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-%ED%94%84%EB%A1%AC%ED%94%84%ED%8A%B8-%ED%85%9C%ED%94%8C%EB%A6%BF-%ED%94%84%EB%A1%AC%ED%94%84%ED%8A%B8%EB%A5%BC-%EB%8F%99%EC%A0%81%EC%9C%BC%EB%A1%9C-%EC%A0%84%EC%86%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    프롬프트 템플릿 - 프롬프트를 동적으로 전송
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    TavernHelper 스크립트 - 백그라운드 제어 및 변수 활용
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    TavernHelper 스크립트 - 백그라운드 제어 및 변수 활용
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="목차">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      목차
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mvu" class="md-nav__link">
    <span class="md-ellipsis">
      
        MVU 이벤트 리스닝
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command_parsed" class="md-nav__link">
    <span class="md-ellipsis">
      
        COMMAND_PARSED: 변수 업데이트 명령 파싱 완료
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="COMMAND_PARSED: 변수 업데이트 명령 파싱 완료">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        예시 1: 불필요한 기호 제거
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable_update_ended" class="md-nav__link">
    <span class="md-ellipsis">
      
        VARIABLE_UPDATE_ENDED: 변수 업데이트 종료
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mvu_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        스크립트 전용 MVU 변수
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mvu_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        코드에서 직접 MVU 변수 가져오기 및 업데이트
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        변수로 녹색 불 활성화하기
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ai" class="md-nav__link">
    <span class="md-ellipsis">
      
        코드에서 AI 생성 요청 및 결과로 변수 업데이트
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        스크립트로 더 많은 기능 구현하기
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-%EC%83%81%ED%83%9C%EB%B0%94/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    상태바
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-%EB%B3%80%EC%88%98-%EA%B5%AC%EC%A1%B0-%EC%9E%91%EC%84%B1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    변수 구조 작성
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-%EA%B8%B0%EC%A1%B4-MVU-%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    기존 MVU 마이그레이션
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-%EC%9E%91%EC%84%B1-%ED%85%9C%ED%94%8C%EB%A6%BF-%EC%82%AC%EC%9A%A9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    작성 템플릿 사용
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-MVU%EA%B0%80-AI%EB%A5%BC-%EB%B0%94%EB%B3%B4%EB%A1%9C-%EB%A7%8C%EB%93%9C%EB%82%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MVU가 AI를 바보로 만드나
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-%EC%A7%88%EB%AC%B8%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    질문하는 방법
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="목차">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      목차
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mvu" class="md-nav__link">
    <span class="md-ellipsis">
      
        MVU 이벤트 리스닝
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command_parsed" class="md-nav__link">
    <span class="md-ellipsis">
      
        COMMAND_PARSED: 변수 업데이트 명령 파싱 완료
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="COMMAND_PARSED: 변수 업데이트 명령 파싱 완료">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        예시 1: 불필요한 기호 제거
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable_update_ended" class="md-nav__link">
    <span class="md-ellipsis">
      
        VARIABLE_UPDATE_ENDED: 변수 업데이트 종료
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mvu_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        스크립트 전용 MVU 변수
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mvu_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        코드에서 직접 MVU 변수 가져오기 및 업데이트
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        변수로 녹색 불 활성화하기
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ai" class="md-nav__link">
    <span class="md-ellipsis">
      
        코드에서 AI 생성 요청 및 결과로 변수 업데이트
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        스크립트로 더 많은 기능 구현하기
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="tavernhelper">TavernHelper 스크립트: 백그라운드 제어 및 변수 활용<a class="headerlink" href="#tavernhelper" title="Permanent link">¶</a></h1>
<p>우리는 변수 구조를 통해 변수 업데이트에 대해 이미 많은 제한을 둘 수 있었습니다. 예를 들어, 다음은 우리가 이전에 문지기(Gatekeeper) 캐릭터 작성 도우미에게 요청했던 변수 결과입니다.</p>
<div class="highlight"><span class="filename">변수 생성 프롬프트 예시</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="l l-Scalar l-Scalar-Plain">변수를 생성하세요!</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="l l-Scalar l-Scalar-Plain">- 월드 경로 하위에 현재 시간, 현재 날짜 및 최근 사건을 기록</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="l l-Scalar l-Scalar-Plain">- 주인공의 여동생 하쿠아(Bai Ya)의 현재 주인공에 대한 의존도, 복장 및 칭호를 기록</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- 의존도는 반드시 0~100 사이여야 함</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- 복장은 상의, 하의, 속옷, 양말, 신발, 장식을 포함</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- 칭호는 칭호의 효과와 그에 대한 하쿠아의 자가 평가를 기록해야 하며, 자가 평가가 비어있을 경우 기본값을 "평가 대기"로 설정</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- 칭호에는 수량 상한이 있으며, 의존도가 높을수록 더 많은 칭호를 가질 수 있음 (의존도가 0일 때는 칭호 보유 불가, 1~10일 때는 1개 보유 가능, 이후 순차적으로 적용). 만약 칭호가 보유 가능 수량을 초과하면 가장 오래된 칭호를 제거해야 함</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="l l-Scalar l-Scalar-Plain">- 주인공 아이템란에 있는 현재 아이템 기록</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">아이템 설명, 수량. 만약 수량을 적지 않으면 기본 수량은 1, 수량이 양수가 아니라면 해당 아이템을 즉시 삭제해야 함</span>
</code></pre></div>
<p>보시다시피, 변수 구조 내에서 이미 많은 기능을 구현했습니다.</p>
<ul>
<li>
<p>변수값 제한: "의존도는 반드시 0~100 사이여야 함"</p>
</li>
<li>
<p>변수값 오류 시 자동 수정: "만약 수량이 양수가 아니라면 해당 아이템을 즉시 삭제해야 함"</p>
</li>
<li>
<p>AI가 변수 삽입 시 필드를 생략할 경우 기본값 설정: "만약 수량을 적지 않으면 기본 수량은 1"</p>
</li>
<li>
<p>변수 수량 상한: "칭호에는 수량 상한이 있으며..."</p>
</li>
<li>
<p>......</p>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">변수 구조의 한계와 스크립트의 필요성</p>
<p>변수 구조는 업데이트된 후의 변수 값을 검증하고 수정하는 데에만 사용할 수 있습니다.</p>
<ul>
<li>Tavern의 다른 정보를 가져올 수 없음</li>
<li>업데이트 전의 변수 값과 비교할 수 없음</li>
<li>Tavern과 다른 상호작용을 하거나 Tavern 내용을 수정할 수 없음</li>
</ul>
<p>따라서 불가능한 기능이 많으며, 이때 우리는 <strong>Tavern Assistant 스크립트</strong>나 <strong>Tavern Assistant 인터페이스</strong>를 사용해야 합니다.</p>
</div>
<p>활용 예시: 쇼핑 기능
예를 들어, 변수를 이용해 상품 쇼핑 등의 기능을 만든다고 가정해 봅시다. 플레이어가 무엇을 살지 일일이 타이핑하고 AI가 구매 가능 여부를 계산하고 금액을 차감하게 하는 것보다는, Tavern Assistant를 사용하여 프론트엔드 인터페이스나 스크립트를 제작하는 것이 훨씬 효율적입니다.</p>
<p>인터페이스에 상품명, 이미지, 가격을 표시하여 플레이어가 버튼을 클릭해 구매하게 하고, 모든 구매가 완료된 후에 구매 과정 로그와 결과만 AI에게 전송하면 됩니다.</p>
<p align="center">
  <a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="https://vwdygpvfycixugqsgwgn.supabase.co/storage/v1/object/public/post-images/1980dc04-3f08-4581-88cb-b949a10d585b/e70d7b01-34a3-42ba-a87a-cdba17caa2d6.jpg" data-desc-position="bottom"><img src="https://vwdygpvfycixugqsgwgn.supabase.co/storage/v1/object/public/post-images/1980dc04-3f08-4581-88cb-b949a10d585b/e70d7b01-34a3-42ba-a87a-cdba17caa2d6.jpg" width="400"></a>
</p>

<p>Tavern Assistant 프론트엔드 인터페이스나 스크립트의 구체적인 작성 방법은 <strong><a href="https://stagedog.github.io/%E9%9D%92%E7%A9%BA%E8%8E%89/%E5%B7%A5%E5%85%B7%E7%BB%8F%E9%AA%8C/%E5%AE%9E%E6%97%B6%E7%BC%96%E5%86%99%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2%E6%88%96%E8%84%9A%E6%9C%AC/">Aozora Rii(青空莉)의 실시간 프론트엔드 인터페이스 또는 스크립트 작성</a></strong>을 참고해 주세요. 여기서는 MVU가 추가로 제공하는 코드 기능과 이에 대응하는 예제를 통해, 프론트엔드 인터페이스나 스크립트가 변수를 어떻게 제어하고 활용할 수 있는지 소개하겠습니다.</p>
<p>(하지만 프론트엔드 인터페이스나 스크립트가 이 기능들만 수행할 수 있다는 뜻은 아닙니다. 예를 들어, MVU 자체도 하나의 Tavern Assistant 스크립트입니다!)</p>
<h2 id="mvu">MVU 이벤트 리스닝<a class="headerlink" href="#mvu" title="Permanent link">¶</a></h2>
<p>MVU 변수 프레임워크가 어떻게 작동하는지 다시 한번 간단히 상기해 봅시다.</p>
<ul>
<li>MVU는 <code>[initvar]</code> 및 <code>&lt;initvar&gt;</code> 블록을 읽어 변수를 초기화합니다.</li>
<li>AI가 변수 출력 형식에 맞춰 변수 업데이트 명령을 출력하면, MVU가 이 명령을 파싱 하여 변수를 업데이트합니다.</li>
</ul>
<p>이 과정에서 다음과 같은 여러 단계를 확인할 수 있습니다.</p>
<ul>
<li>(새 채팅 시작 시에만) 변수 초기화 완료 (<code>VARIABLE_INITIALIZED</code>)</li>
<li>변수 업데이트 시작 (<code>VARIABLE_UPDATE_STARTED</code>)</li>
<li>변수 업데이트 명령 파싱 완료 (<code>COMMAND_PARSED</code>)</li>
<li>스크립트가 파싱 된 업데이트 명령을 사용해 순차적으로 변수를 업데이트하며, 매 업데이트마다 변수 구조를 사용해 결과를 검증</li>
<li>변수 업데이트 종료 (<code>VARIABLE_UPDATE_ENDED</code>)</li>
<li>스크립트가 변수 결과를 해당 메시지(로어북/채팅)에 저장하기 직전 (<code>BEFORE_MESSAGE_UPDATE</code>)</li>
</ul>
<p>MVU는 이러한 단계들에 대해 <strong>"이벤트와 해당 정보"</strong>를 전송합니다. 우리는 새로운 Tavern Assistant 스크립트를 만들어 이 이벤트들을 리스닝(감지) 하기만 하면, 해당 단계에서 추가 기능을 실행하거나 MVU의 업데이트 과정을 조정할 수 있습니다.</p>
<div class="admonition info">
<p class="admonition-title">팁</p>
<p>아래 내용이 무슨 말인지 이해가 안 가시나요? 괜찮습니다. 지금 중요한 것은 <strong>무엇을 할 수 있는지</strong> 아는 것입니다! </p>
<p>그다음 <strong>'실시간 프론트엔드 인터페이스 또는 스크립트 작성'</strong> 문서를 읽고, 작성 템플릿에 포함된 <code>@types/iframe/exported.mvu.d.ts</code> 파일과 여기 있는 예제를 AI에게 보내서 대신 작성해달라고 시키면 됩니다.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">경고</p>
<p>아래 기능을 사용하기 전에, 반드시 코드 맨 윗부분에 <code>await waitGlobalInitialized('Mvu');</code> 한 줄을 추가하여 MVU 변수 프레임워크의 초기화가 완료될 때까지 기다려야 합니다.</p>
<p>이 점을 강조하기 위해, 이하 모든 예제 코드의 시작 부분에는 <code>await waitGlobalInitialized('Mvu');</code>가 추가되어 있습니다. 만약 더 복잡한 코드를 작성한다면, 코드의 최상단에 <code>waitGlobalInitialized('Mvu');</code>를 한 번만 추가하면 되며, 여러 번 추가할 필요는 없습니다.</p>
</div>
<h2 id="command_parsed">COMMAND_PARSED: 변수 업데이트 명령 파싱 완료<a class="headerlink" href="#command_parsed" title="Permanent link">¶</a></h2>
<p>"변수 업데이트 명령 파싱 완료" 이벤트(<code>Mvu.events.COMMAND_PARSED</code>)를 리스닝(감지)하면, 대응하는 변수 업데이트 명령을 가져와 수정(Repair)할 수 있습니다.</p>
<h3 id="1">예시 1: 불필요한 기호 제거<a class="headerlink" href="#1" title="Permanent link">¶</a></h3>
<p>예를 들어, Gemini 모델이 중국어(또는 한글) 사이에 <code>-</code>를 집어넣는 문제를 수정하여, <code>Role.Luo-Luo</code>를 <code>Role.LuoLuo</code>로 고치는 경우입니다.</p>
<div class="highlight"><span class="filename">하이픈(-) 제거 스크립트</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">COMMAND_PARSED</span><span class="p">,</span><span class="w"> </span><span class="nx">commands</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nx">commands</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">command</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="c1">// 명령의 첫 번째 인자(변수 경로)에서 모든 '-'를 제거</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="nx">command</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">command</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">replaceAll</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">);</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="p">});</span>
</code></pre></div>
<p>또 다른 예로, 번체자를 간체자로 자동 변환하여 絡絡을 络络으로 수정하는 경우입니다. (한국어 사용자의 경우, 특정 오타 자동 수정 등에 응용할 수 있습니다.)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>import { toSimplified } from 'chinese-simple2traditional';
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>await waitGlobalInitialized('Mvu');
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>eventOn(Mvu.events.COMMAND_PARSED, commands =&gt; {
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>  commands.forEach(command =&gt; {
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    // 명령의 첫 번째 인자(변수 경로 등)를 간체자로 변환
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    command.args[0] = toSimplified(command.args[0]);
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>  });
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>});
</code></pre></div>
<h3 id="variable_update_ended">VARIABLE_UPDATE_ENDED: 변수 업데이트 종료<a class="headerlink" href="#variable_update_ended" title="Permanent link">¶</a></h3>
<p>"변수 업데이트 종료" 이벤트(Mvu.events.VARIABLE_UPDATE_ENDED)를 리스닝하면, 업데이트 <strong>전</strong>과 <strong>후</strong>의 변수 값을 모두 가져올 수 있어, 결과에 대한 추가 처리를 수행할 수 있습니다.</p>
<p>예시: 변수 변경 알림 팝업
예를 들어, 다음과 같이 화면에 업데이트 전후의 변수 값을 팝업으로 띄워줄 수 있습니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="nx">old_variables</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nx">toastr</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="sb">`업데이트 전 하쿠아 의존도는: </span><span class="si">${</span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">old_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nx">toastr</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="sb">`업데이트 후 하쿠아 의존도는: </span><span class="si">${</span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">});</span>
</code></pre></div>
<p>또는, 다음과 같이 업데이트된 변수 값을 <strong>강제로 수정</strong>할 수도 있습니다.</p>
<div class="highlight"><span class="filename">변수 값 강제 수정 스크립트</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="hll"><span class="w">  </span><span class="c1">// 업데이트 결과가 무엇이든 관계없이, 하쿠아의 의존도를 강제로 0으로 변경</span>
</span><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="nx">_</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="p">});</span>
</code></pre></div>
<p>이것만으로도 우리는 정말 많은 기능을 구현할 수 있습니다.</p>
<p>그중 일부는 <strong>변수 구조</strong>에서도 이미 구현 가능한 기능들입니다:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:5"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><input id="__tabbed_1_3" name="__tabbed_1" type="radio"><input id="__tabbed_1_4" name="__tabbed_1" type="radio"><input id="__tabbed_1_5" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">의존도 범위 제한 (0~100)</label><label for="__tabbed_1_2">아이템 자동 삭제 (수량 0 이하)</label><label for="__tabbed_1_3">칭호 수량 상한 제어</label><label for="__tabbed_1_4">특정 조건 기록 (플래그)</label><label for="__tabbed_1_5">데이터 일괄 삭제 (사망 등)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>의존도 수치가 항상 지정된 범위 내에 있도록 강제합니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="c1">// 하쿠아의 의존도를 0과 100 사이로 고정 (_.clamp 활용)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="nx">_</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">clamp</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">));</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="p">});</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>아이템 수량이 0 이하가 되면 목록에서 즉시 제거합니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="c1">// 주인공의 아이템란에서 수량이 0보다 큰 항목만 남김</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="nx">_</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.주인공.아이템란'</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">pickBy</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="p">({</span><span class="nx">수량</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">수량</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">));</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="p">});</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>의존도가 높을수록 더 많은 칭호를 가질 수 있도록 동적으로 제한합니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="nx">_</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.칭호'</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="nx">_</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">      </span><span class="p">.</span><span class="nx">entries</span><span class="p">()</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">      </span><span class="c1">// 의존도/10(올림) 값만큼 최신 칭호 유지</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">      </span><span class="p">.</span><span class="nx">takeRight</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">10</span><span class="p">))</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">      </span><span class="p">.</span><span class="nx">value</span><span class="p">(),</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">  </span><span class="p">);</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="p">});</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>의존도가 처음으로 특정 수치를 넘었을 때 시스템 플래그를 활성화합니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="c1">// 의존도가 30을 초과하면 '突破30' 플래그를 true로 설정</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">30</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="nx">_</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.$flag.하쿠아의존도돌파30'</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="p">});</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>특정 캐릭터가 사망 처리될 경우 관련 변수 데이터를 모두 제거하여 정리합니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="c1">// 아오조라 리(青空莉)의 사망 상태가 true이면 관련 데이터 삭제</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.아오조라리.사망'</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="c1">// 아오조라 리와 관련된 모든 변수 제거</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="nx">_</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.아오조라리'</span><span class="p">);</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="p">});</span>
</code></pre></div>
</div>
</div>
</div>
<p>하지만 변수 구조 스크립트는 이전의 변수 상태를 가져올 수 없으므로, <code>old_variables</code>를 활용해 다음과 같은 작업들을 수행할 수 없습니다. 반면, Tavern Assistant 스크립트를 이용하면 가능합니다.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"><input id="__tabbed_2_2" name="__tabbed_2" type="radio"><input id="__tabbed_2_3" name="__tabbed_2" type="radio"><div class="tabbed-labels"><label for="__tabbed_2_1">의존도 변동 폭 제한 (±3)</label><label for="__tabbed_2_2">의존도 30 돌파 감지</label><label for="__tabbed_2_3">AI 변수 수정 방지</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>의존도 수치가 한 번에 ±3 이상 변하지 않도록 제한합니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="nx">old_variables</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">old_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">old_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">);</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="c1">// 새로운 호감도는 반드시 (구 호감도 - 3)과 (구 호감도 + 3) 사이여야 함</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">  </span><span class="nx">_</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">clamp</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">old_value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">old_value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3</span><span class="p">));</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="p">});</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>의존도가 30을 돌파하는 순간을 감지하고 알림을 띄웁니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="nx">old_variables</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">old_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">old_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">);</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">new_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">);</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">old_value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">30</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">new_value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">30</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="nx">toastr</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="s1">'하쿠아 의존도가 30을 돌파했습니다!'</span><span class="p">);</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="p">});</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>AI가 특정 변수를 업데이트하지 못하게 막습니다 (강제 롤백).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="nx">old_variables</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="c1">// 새로운 하쿠아 의존도를 강제로 구 의존도로 설정하여 AI의 업데이트를 취소함</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">  </span><span class="nx">_</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">old_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">));</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="p">});</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="mvu_1">스크립트 전용 MVU 변수<a class="headerlink" href="#mvu_1" title="Permanent link">¶</a></h2>
<p>스크립트로 이렇게 많은 기능을 구현할 수 있다면, 오직 스크립트에서만 사용할 변수를 설정하고 싶을 수도 있습니다……</p>
<p>변수가 AI에 의해 업데이트되지 않게 하거나 AI에게 보이지 않게 하는 방법을 기억하시나요? 변수 이름 앞에 <code>_</code>를 붙여 AI가 업데이트하지 못하게 하거나, <code>$</code>를 붙여 AI에게 보이지 않게 만들 수 있습니다!</p>
<p>물론, 방금 <code>VARIABLE_UPDATE_ENDED</code>를 사용하여 변수가 AI에 의해 업데이트되지 않도록 하는 방법도 보여드렸습니다:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="nx">old_variables</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="c1">// 새로운 하쿠아 의존도를 강제로 구 의존도로 설정하여 AI의 업데이트를 취소함</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="nx">_</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">new_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">old_variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">));</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="p">});</span>
</code></pre></div>
<h2 id="mvu_2">코드에서 직접 MVU 변수 가져오기 및 업데이트<a class="headerlink" href="#mvu_2" title="Permanent link">¶</a></h2>
<p>MVU 이벤트를 수신하는 것 외에도, 우리는 직접 MVU 변수를 가져오거나 업데이트할 수 있으며, 텍스트 내의 <code>&lt;JSONPatch&gt;</code> 등 업데이트 명령을 주도적으로 구문 분석할 수도 있습니다.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:3"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio"><input id="__tabbed_3_2" name="__tabbed_3" type="radio"><input id="__tabbed_3_3" name="__tabbed_3" type="radio"><div class="tabbed-labels"><label for="__tabbed_3_1">MVU 변수 가져오기</label><label for="__tabbed_3_2">MVU 변수 업데이트</label><label for="__tabbed_3_3">텍스트 내 업데이트 명령 파싱</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1">// 5번째 메시지의 MVU 변수 가져오기</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">getMvuData</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1">// 마지막 메시지의 MVU 변수 가져오기</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">getMvuData</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">});</span><span class="w">  </span><span class="c1">// 또는 `message_id: 'latest'`</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="c1">// 뒤에서 두 번째 메시지의 MVU 변수 가져오기</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">getMvuData</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">2</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="c1">// 프론트엔드 인터페이스에서, 현재 메시지의 MVU 변수 가져오기</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="kd">const</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">getMvuData</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="nx">getCurrentMessageId</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="c1">// 현재 프론트엔드 인터페이스가 있는 메시지의 MVU 변수 가져오기</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mvu_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">getMvuData</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="nx">getCurrentMessageId</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="c1">// 하쿠아 의존도 5 증가</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="nx">_</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">mvu_data</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="p">);</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="c1">// 업데이트된 결과를 메시지에 다시 쓰기</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="k">await</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">replaceMvuData</span><span class="p">(</span><span class="nx">mvu_data</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="nx">getCurrentMessageId</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mvu_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">getMvuData</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="c1">// 어딘가에서 얻은 텍스트 내 업데이트 명령을 구문 분석합니다.</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="c1">// 여기서는 텍스트를 가정했지만, 'generate' 등에서 가져올 수도 있습니다.</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;JSONPatch&gt;생략&lt;/JSONPatch&gt;"</span><span class="p">;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">new_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">parseMessage</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">mvu_data</span><span class="p">);</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="k">await</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">replaceMvuData</span><span class="p">(</span><span class="nx">new_data</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="nx">getCurrentMessageId</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="_1">변수로 녹색 불 활성화하기<a class="headerlink" href="#_1" title="Permanent link">¶</a></h2>
<p>우리는 아오조라 리(青空莉)가 활성화 파트에서 언급한 "코드를 직접 작성하여 항목 활성화 제어" 방법 중 하나인 <code>injectPrompts</code>를 사용하여, 변수 값을 녹색 불을 활성화할 수 있는 사전 스캔 텍스트로 변환할 수 있습니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="c1">// 현재 하쿠아 의존도 수치 가져오기</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">);</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="nx">injectPrompts</span><span class="p">([</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">'활성화-하쿠아의존도'</span><span class="p">,</span><span class="w">  </span><span class="c1">// 여기서 id는 프롬프트의 고유 식별자입니다.</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">                             </span><span class="c1">// 만약 나중에 동일한 id로 injectPrompts를 다시 실행하면, 이전 프롬프트가 대체됩니다.</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="sb">`하쿠아 의존도=</span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w">  </span><span class="c1">// '하쿠아 의존도=xxx' 텍스트 주입, 녹색 불 활성화 용도로만 사용됨;</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">                                       </span><span class="c1">// 이렇게 하면, 녹색 불 키워드에 '하쿠아 의존도=xxx'를 입력하여 활성화할 수 있습니다.</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">      </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="s1">'none'</span><span class="p">,</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">      </span><span class="nx">depth</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">      </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">'user'</span><span class="p">,</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">      </span><span class="nx">should_scan</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">  </span><span class="p">]);</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="p">});</span>
</code></pre></div>
<p>이렇게 하면 현재 채팅 내에 항상 <code>하쿠아 의존도=xxx</code>와 같은 프롬프트가 존재하여 녹색 불 활성화에만 사용되며, 변수가 업데이트될 때마다 스크립트가 <code>injectPrompts</code>로 이를 갱신하여 항상 최신 수치를 유지하도록 보장합니다.</p>
<p>물론, 녹색 불 키워드 작성을 더 간단하게 하기 위해 <code>하쿠아 의존도</code> 대신 <code>하쿠아 단계 1</code>과 같이 직접 주입할 수도 있습니다:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nx">eventOn</span><span class="p">(</span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">VARIABLE_UPDATE_ENDED</span><span class="p">,</span><span class="w"> </span><span class="nx">variables</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span><span class="c1">// 현재 하쿠아 의존도 수치 가져오기</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">variables</span><span class="p">,</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">);</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'하쿠아 단계 '</span><span class="p">;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">20</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="nx">content</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">'1'</span><span class="p">;</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">40</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">    </span><span class="nx">content</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">'2'</span><span class="p">;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">    </span><span class="nx">content</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">'3'</span><span class="p">;</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">80</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">    </span><span class="nx">content</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">'4'</span><span class="p">;</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">    </span><span class="nx">content</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">'5'</span><span class="p">;</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">  </span><span class="nx">injectPrompts</span><span class="p">([</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">'활성화-하쿠아의존도'</span><span class="p">,</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">      </span><span class="nx">content</span><span class="p">,</span><span class="w">  </span><span class="c1">// '하쿠아 단계 1', '하쿠아 단계 2', ...</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">      </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="s1">'none'</span><span class="p">,</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">      </span><span class="nx">depth</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">      </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">'user'</span><span class="p">,</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">      </span><span class="nx">should_scan</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">  </span><span class="p">]);</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="p">});</span>
</code></pre></div>
<p>또 다른 방법으로는 <code>injectPrompts</code>의 <code>filter</code> 필드를 활용하여, 주어진 조건이 충족될 때만 사용되는 프롬프트를 직접 주입하는 것입니다. 예제 카드의 즉시 이벤트 스크립트가 바로 이 방식을 사용합니다:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nx">injectPrompts</span><span class="p">([</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">   </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">'활성화-의존도최저시즉시이벤트'</span><span class="p">,</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">   </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="s1">'none'</span><span class="p">,</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">   </span><span class="nx">depth</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">   </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">'system'</span><span class="p">,</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">   </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s1">'【【의존도 최저 시 즉시 이벤트】】'</span><span class="p">,</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">   </span><span class="c1">// `getAllVariables()`로 최신 변수를 가져오고, 그중 하쿠아 의존도가 0일 때만 이 프롬프트를 활성화</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">   </span><span class="nx">filter</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">getAllVariables</span><span class="p">(),</span><span class="w"> </span><span class="s1">'stat_data.하쿠아.의존도'</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">   </span><span class="nx">should_scan</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="p">])</span>
</code></pre></div>
<p>물론, <code>injectPrompts</code>는 녹색 불 활성화 전용 프롬프트를 주입하는 것 외에도, <strong>Dn 프롬프트를 직접 주입</strong>할 수도 있습니다. 자세한 내용은 <strong><a href="https://stagedog.github.io/%E9%9D%92%E7%A9%BA%E8%8E%89/%E5%B7%A5%E5%85%B7%E7%BB%8F%E9%AA%8C/%E9%85%92%E9%A6%86%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E4%B8%96%E7%95%8C%E4%B9%A6/">Tavern이 World Book을 처리하는 방법</a></strong>을 참고해 주세요.</p>
<h2 id="ai">코드에서 AI 생성 요청 및 결과로 변수 업데이트<a class="headerlink" href="#ai" title="Permanent link">¶</a></h2>
<p>물론 프론트엔드 인터페이스나 스크립트에서 직접 AI 생성을 요청할 수도 있습니다. 생성 결과에 <code>&lt;JSONPatch&gt;</code> 등의 변수 업데이트 명령이 포함되어 있다면, 이를 파싱하여 변수를 업데이트할 수 있습니다.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">waitGlobalInitialized</span><span class="p">(</span><span class="s1">'Mvu'</span><span class="p">);</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="c1">// 기존 변수 가져오기</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">old_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">getMvuData</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="nx">getCurrentMessageId</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="c1">// AI 생성 요청</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">generate</span><span class="p">({</span><span class="w"> </span><span class="nx">user_input</span><span class="o">:</span><span class="w"> </span><span class="s1">'안녕하세요'</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="c1">// 생성 결과 파싱</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">new_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">parseMessage</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">old_data</span><span class="p">);</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="c1">// 업데이트된 변수를 해당 메시지에 다시 쓰기</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="k">await</span><span class="w"> </span><span class="nx">Mvu</span><span class="p">.</span><span class="nx">replaceMvuData</span><span class="p">(</span><span class="nx">new_data</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'message'</span><span class="p">,</span><span class="w"> </span><span class="nx">message_id</span><span class="o">:</span><span class="w"> </span><span class="nx">getCurrentMessageId</span><span class="p">()</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
<p>자연스럽게, 이 방식을 활용하면 플레이어가 인터페이스 내에서 직접 AI와 대화할 수 있도록 만들 수 있습니다. 자세한 내용은 <strong><a href="https://stagedog.github.io/%E9%9D%92%E7%A9%BA%E8%8E%89/%E5%B7%A5%E5%85%B7%E7%BB%8F%E9%AA%8C/%E5%AE%9E%E6%97%B6%E7%BC%96%E5%86%99%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2%E6%88%96%E8%84%9A%E6%9C%AC/">실시간 프론트엔드 인터페이스 또는 스크립트 작성</a></strong>을 참고해 주세요.</p>
<h2 id="_2">스크립트로 더 많은 기능 구현하기<a class="headerlink" href="#_2" title="Permanent link">¶</a></h2>
<p><strong><a href="https://stagedog.github.io/%E9%9D%92%E7%A9%BA%E8%8E%89/%E5%B7%A5%E5%85%B7%E7%BB%8F%E9%AA%8C/%E5%AE%9E%E6%97%B6%E7%BC%96%E5%86%99%E5%89%8D%E7%AB%AF%E7%95%8C%E9%9D%A2%E6%88%96%E8%84%9A%E6%9C%AC/">실시간 프론트엔드 인터페이스 또는 스크립트 작성</a></strong>을 읽은 후, 작성 템플릿 폴더에 있는 <code>@types/iframe/exported.mvu.d.ts</code> 파일과 여기 있는 예제 코드를 AI에게 보내서 대신 작성하게 시키면 됩니다!</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  맨위로
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\ud074\ub9bd\ubcf4\ub4dc\uc5d0 \ubcf5\uc0ac\ub428", "clipboard.copy": "\ud074\ub9bd\ubcf4\ub4dc\ub85c \ubcf5\uc0ac", "search.result.more.one": "\uc774 \ubb38\uc11c\uc5d0\uc11c 1\uac1c\uc758 \uac80\uc0c9 \uacb0\uacfc \ub354 \ubcf4\uae30", "search.result.more.other": "\uc774 \ubb38\uc11c\uc5d0\uc11c #\uac1c\uc758 \uac80\uc0c9 \uacb0\uacfc \ub354 \ubcf4\uae30", "search.result.none": "\uac80\uc0c9\uc5b4\uc640 \uc77c\uce58\ud558\ub294 \ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4", "search.result.one": "1\uac1c\uc758 \uc77c\uce58\ud558\ub294 \ubb38\uc11c", "search.result.other": "#\uac1c\uc758 \uc77c\uce58\ud558\ub294 \ubb38\uc11c", "search.result.placeholder": "\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694", "search.result.term.missing": "\ud3ec\ud568\ub418\uc9c0 \uc54a\uc740 \uac80\uc0c9\uc5b4", "select.version": "\ubc84\uc804 \uc120\ud0dd"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>